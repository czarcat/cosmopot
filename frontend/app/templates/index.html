<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dev Stack Dashboard</title>
    <style>
      :root {
        color-scheme: dark light;
        font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      }
      body {
        margin: 0;
        padding: 0 1.5rem 3rem;
        background: #0f172a;
        color: #f8fafc;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        gap: 2rem;
      }
      header {
        padding-top: 2rem;
      }
      h1 {
        margin: 0 0 0.5rem 0;
        font-size: 2.5rem;
      }
      p.description {
        margin: 0;
        color: #cbd5f5;
      }
      section.card {
        background: rgba(15, 23, 42, 0.8);
        border: 1px solid rgba(148, 163, 184, 0.2);
        border-radius: 14px;
        padding: 1.5rem;
        box-shadow: 0 10px 40px rgba(15, 23, 42, 0.4);
        backdrop-filter: blur(20px);
      }
      .status {
        display: grid;
        gap: 1rem;
      }
      .status-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 1rem;
        background: rgba(30, 41, 59, 0.9);
        border-radius: 10px;
        border: 1px solid rgba(148, 163, 184, 0.2);
      }
      .status-tag {
        padding: 0.35rem 0.75rem;
        border-radius: 999px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
      .status-tag.ok {
        background: rgba(34, 197, 94, 0.2);
        color: #86efac;
      }
      .status-tag.degraded {
        background: rgba(239, 68, 68, 0.2);
        color: #fca5a5;
      }
      footer {
        margin-top: auto;
        color: #94a3b8;
        font-size: 0.875rem;
      }
      a {
        color: #38bdf8;
      }
      code {
        background: rgba(148, 163, 184, 0.15);
        padding: 0.2rem 0.45rem;
        border-radius: 6px;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Developer Stack Control Center</h1>
      <p class="description">
        Unified status view of the FastAPI backend, Celery worker, and observability tooling.
      </p>
    </header>

    <section class="card">
      <h2>System status</h2>
      {% if error %}
      <p>Unable to reach backend health endpoint: <code>{{ error }}</code></p>
      {% elif not health %}
      <p>Waiting for health data from the backend...</p>
      {% else %}
      <div class="status">
        <div class="status-item">
          <span>Backend</span>
          <span class="status-tag {{ 'ok' if health['status'] == 'ok' else 'degraded' }}">{{ health['status'] }}</span>
        </div>
        {% for name, info in health['dependencies'].items() %}
        <div class="status-item">
          <span>{{ name|capitalize }}</span>
          <span class="status-tag {{ 'ok' if info['status'] == 'ok' else 'degraded' }}">{{ info['status'] }}</span>
        </div>
        {% if info['detail'] %}
        <div class="status-item">
          <span>{{ name|capitalize }} detail</span>
          <code>{{ info['detail'] }}</code>
        </div>
        {% endif %}
        {% endfor %}
      </div>
      {% endif %}
    </section>

    <footer>
      Routed through <strong>Nginx</strong>. Observability available at
      <a href="/prometheus/" target="_blank">/prometheus/</a> and
      <a href="/grafana/" target="_blank">/grafana/</a>.
    </footer>
  </body>
</html>
